{
  "$schema": "https://raw.githubusercontent.com/Microsoft/azure-pipelines-task-lib/master/tasks.schema.json",
  "id": "d7f8e412-adce-4539-b827-c5c4220e221c",
  "name": "GoogleCloudFunctions",
  "friendlyName": "Google Cloud Functions",
  "description": "Deploy code to GCP Functions or create, remove and call functions",
  "helpUrl": "https://github.com/nexsolab/azure-devops-google-cloud-tools",
  "helpMarkDown": "[Learn more about this task](https://github.com/nexsolab/azure-devops-google-cloud-tools#readme) or [see the Functions documentation](https://cloud.google.com/sdk/gcloud/reference/functions)",
  "category": "Deploy",
  "runsOn": ["Agent"],
  "visibility": ["Build", "Release"],
  "author": "Gabriel Anderson",
  "instanceNameFormat": "$(operation) Google Cloud Function",
  "version": {
    "Major": 0,
    "Minor": 1,
    "Patch": 0
  },
  "groups": [{
      "name": "FunctionCreation",
      "displayName": "Create or Update Function",
      "isExpanded": true
    },
    {
      "name": "GCPResourceOptions",
      "displayName": "Google Cloud resource options",
      "isExpanded": true
    }
  ],
  "inputs": [{
      "name": "authenticationMethod",
      "type": "pickList",
      "label": "Authentication method",
      "defaultValue": "serviceAccount",
      "options": {
        "serviceAccount": "Service Account (Connected Service)",
        "jsonFile": "JSON file credentials"
      }
    },
    {
      "name": "serviceAccount",
      "type": "connectedService:GoogleCloudServiceEndpoint",
      "label": "Google Cloud Service Account",
      "defaultValue": "",
      "required": true,
      "helpMarkDown": "Select the Service Account that should be used for the next steps",
      "visibleRule": "authenticationMethod = serviceAccount"
    },
    {
      "name": "jsonCredentials",
      "type": "secureFile",
      "label": "JSON Credentials file",
      "required": true,
      "defaultValue": "",
      "helpMarkDown": "Select the JSON file with the credentials, see for more information",
      "visibleRule": "authenticationMethod = jsonFile"
    },
    {
      "name": "operation",
      "type": "pickList",
      "label": "Operation",
      "required": true,
      "defaultValue": "deploy",
      "options": {
        "create": "Create/Update",
        "delete": "Delete",
        "deploy": "Deploy",
        "call": "Call function"
      }
    },
    {
      "name": "gcpProject",
      "type": "pickList",
      "label": "Project",
      "groupName": "FunctionCreation",
      "defaultValue": "",
      "required": true,
      "properties": {
        "EditableOptions": "True"
      },
      "helpMarkDown": "Enter or select the Project where this function should be created"
    },
    {
      "name": "gcpRegion",
      "type": "pickList",
      "label": "Region",
      "groupName": "FunctionCreation",
      "defaultValue": "",
      "required": true,
      "properties": {
        "EditableOptions": "True"
      },
      "helpMarkDown": "Enter or select the region where this function should be created"
    },
    {
      "name": "funcName",
      "type": "string",
      "label": "Function name",
      "groupName": "FunctionCreation",
      "defaultValue": "",
      "required": true,
      "helpMarkDown": "A user-defined name of the function. Function names must be unique globally"
    },
    {
      "name": "funcDesc",
      "type": "string",
      "label": "Description",
      "groupName": "FunctionCreation",
      "defaultValue": "",
      "required": false,
      "helpMarkDown": "User-provided description of a function"
    }
  ],
  "dataSourceBindings": [{
      "target": "gcpRegion",
      "dataSourceName": "GCPListFunctionRegions",
      "endpointId": "$(serviceAccount)",
      "parameters": {
        "Project": "$(gcpProject)"
      }
    }
  ],
  "OutputVariables": [{
    "name": "FunctionUrl",
    "description": "Function URL"
  }],
  "execution": {
    "Node": {
      "target": "dist/gcloudcli.js",
      "argumentFormat": ""
    }
  },
  "messages": {
    "ToolFailed": "Tool install failed: %s"
  }
}
